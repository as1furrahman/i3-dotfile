# ============================================================================
# Performance Optimizations for ASUS Zenbook S 13 OLED (UM5302TA)
# AMD Ryzen 7 6800U | Radeon 680M | Samsung 990 Pro NVMe
# Optimized for: Development, Performance, Battery Life
# ============================================================================
# Install: sudo cp this-file /etc/sysctl.d/99-performance.conf && sudo sysctl -p

# ============================================================================
# MEMORY MANAGEMENT
# ============================================================================

# Swappiness: Use RAM aggressively before swapping (default: 60)
# Low value ideal for 14GB RAM + fast NVMe
vm.swappiness = 10

# VFS cache pressure: Keep filesystem metadata cached (default: 100)
vm.vfs_cache_pressure = 50

# Max memory map areas - CRITICAL for AI/ML frameworks
# PyTorch, TensorFlow, large datasets need high values (default: 65530)
vm.max_map_count = 2097152

# Overcommit memory: Allow memory overcommit (useful for ML training)
# 0 = heuristic, 1 = always allow, 2 = never
vm.overcommit_memory = 0
vm.overcommit_ratio = 80

# ============================================================================
# SAMSUNG 990 PRO NVMe OPTIMIZATIONS
# ============================================================================

# Dirty page tuning - optimized for fast NVMe writes
vm.dirty_background_bytes = 167772160
vm.dirty_bytes = 335544320
vm.dirty_expire_centisecs = 1500
vm.dirty_writeback_centisecs = 300

# ============================================================================
# FILE SYSTEM & HANDLES
# ============================================================================

# Max open files - high for data science/ML (default: ~100000)
fs.file-max = 2097152

# inotify watches for IDEs (VSCode, PyCharm)
fs.inotify.max_user_watches = 524288
fs.inotify.max_user_instances = 1024

# ============================================================================
# NETWORK (for data fetching, model downloads, APIs)
# ============================================================================

# TCP buffer sizes (min, default, max bytes)
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# Connection backlog for many concurrent connections
net.core.somaxconn = 4096
net.core.netdev_max_backlog = 5000

# TCP optimizations
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_slow_start_after_idle = 0

# ============================================================================
# KERNEL SCHEDULER
# ============================================================================

# (sched_migration_cost_ns deprecated in newer kernels, removed to prevent errors)


# ============================================================================
# ADDITIONAL NOTES (AMD Ryzen 7 6800U)
# ============================================================================
# For optimal power/performance, add to GRUB:
#   amd_pstate=passive (handled by hardware_setup.sh)
#   pcie_aspm=force pcie_aspm.policy=powersupersave (for battery)
# Edit /etc/default/grub -> GRUB_CMDLINE_LINUX_DEFAULT, then:
#   sudo update-grub && sudo reboot

